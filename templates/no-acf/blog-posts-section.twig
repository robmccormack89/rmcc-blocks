{#
/**
 * Block Name: Blog posts
 *
 * This is the template that displays the Blog posts block.
 */
#}

{# extend & imports 

#}

{% extends "block.twig" %}

{% import "block-functions.twig" as block_functions %}

{# block fields 

#}

{% set class_w = 'uk-width-1-1' %}
{% set w = 1600 %}
{% set h = 400 %}

{% if second_posts %}
  {% set class_w = 'uk-width-1-2@m' %}
  {% set w = 1200 %}
  {% set h = 620 %}
  {% if second_posts|length > 1 %}
    {% set class_w = 'uk-width-2-5@m' %}
  {% endif %}
{% endif %}

{#

Better logic

{% set class_w = (second_posts) ? ((second_posts|length > 1) ? 'uk-width-2-5@m' : 'uk-width-1-2@m') : 'uk-width-1-1' %}
{% set w = (second_posts) ? 1200 : 1600 %}
{% set h = (second_posts) ? 620 : 400 %}
#}

{# main block 

#}

{% block block_main %}
  {% if first_posts is not empty %}
    <section class="home-blog-posts">
      
      {# posts grid #}
      <div class="uk-grid" uk-grid>
        
        {# 1st post #}
        <div class="home-blog-left first-post {{ class_w }}">
          {% for post in first_posts %}
            <div class="post uk-text-center">
              
              {# img #}
              {% set img1 = post.thumbnail.src|resize(w, h)|default('https://picsum.photos/id/1/' ~ w ~ '/' ~ h) %}
              {{ block_functions.block_img(is_preview, img1, post.thumbnail.alt, {w: w, h: h}) }}
              
              {# title linked #}
              {{ block_functions.block_link_open(is_preview, post.link, {class: 'uk-link-reset'}) }}
                <h3 class="uk-margin-top">{{ post.title }}</h3>
              {{ block_functions.block_link_close(is_preview) }}
              
              {# excerpt #}
              <p>{{ post.preview.length(22).force.read_more('') }}</p>
              
              {# link/btn #}
              {{ block_functions.block_link(is_preview, post.link, 'Read more', {class: 'uk-button uk-button-default uk-button-small'}) }}
              
            </div>
          {% endfor %}
        </div>
        
        {# 2nd & 3rd posts #}
        {% if second_posts %}
        
          {# 2nd post only if 3rd doesnt exist #}
          {% if second_posts|length == 1 %}
            <div class="home-blog-right second-post {{ class_w }}">
              {% for post in second_posts %}
                <div class="post uk-text-center">
                  
                  {# img #}
                  {% set img2 = post.thumbnail.src|resize(w, h)|default('https://picsum.photos/id/2/' ~ w ~ '/' ~ h) %}
                  {{ block_functions.block_img(is_preview, img2, post.thumbnail.alt, {w: w, h: h}) }} {# post img #}
                  
                  {# title linked #}
                  {{ block_functions.block_link_open(is_preview, post.link, {class: 'uk-link-reset'}) }}
                    <h3 class="uk-margin-top">{{ post.title }}</h3>
                  {{ block_functions.block_link_close(is_preview) }}
                  
                  {# excerpt #}
                  <p>{{ post.preview.length(22).force.read_more('') }}</p>
                  
                  {# link/btn #}
                  {{ block_functions.block_link(is_preview, post.link, 'Read more', {class: 'uk-button uk-button-default uk-button-small'}) }}
                  
                </div>
              {% endfor %}
            </div>
          {% endif %}
          
          {# 2nd & 3rd posts if 3rd exists #}
          {% if second_posts|length > 1 %}
            <div class="home-blog-right next-three-posts uk-width-3-5@m">
              <div class="uk-child-width-1-1 uk-grid" uk-grid>
                {% for post in second_posts %}
                  <div class="post">
                    <div class="uk-child-width-1-2@m uk-grid uk-flex uk-flex-middle uk-grid" uk-grid>
                      
                      {# img #}
                      <div>
                        {% set img3 = post.thumbnail.src|resize(720, 509)|default('https://picsum.photos/id/' ~ (loop.index + 2) ~ '/720/509') %}
                        {{ block_functions.block_img(is_preview, img3, post.thumbnail.alt, {w: '720', h: '509'}) }} {# post img #}
                      </div>
                      
                      {# title, content & btn - right #}
                      <div>
                        
                        {{ block_functions.block_link_open(is_preview, post.link, {class: 'uk-link-reset'}) }}
                          <h3 class="uk-h4 uk-margin-remove">{{ post.title }}</h3> {# title linked #}
                        {{ block_functions.block_link_close(is_preview) }}
                        
                        <p class="uk-margin-small">{{ post.preview.length(12).force.read_more('') }}</p> {# excerpt #}
                        
                        <div class="uk-margin-small-top">
                          {{ block_functions.block_link(is_preview, post.link, 'Read more', {class: 'feature-link uk-text-uppercase uk-text-emphasis'}) }} {# link/btn #}
                        </div>
                        
                      </div>
                      
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          
        {% endif %}
        
      </div>
      
      {# view all button #}
      {% if fn('get_option', 'page_for_posts') and fn('wp_count_posts').publish > 3 %}
        <div class="uk-flex uk-flex-center uk-margin-medium-top">
          {{ block_functions.block_link(is_preview, fn('get_permalink', fn('get_option', 'page_for_posts')), 'View all', {class: 'uk-button uk-button-large uk-button-default'}) }}
        </div>
      {% endif %}
      
    </section>
  {% else %}
    No posts found...
  {% endif %}
{% endblock %}